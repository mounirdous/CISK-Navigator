<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>{{ title }} (v{{ version }})</title>
<style>
  :root {
    --bg: #0b1220;
    --panel: #101a30;
    --panel2: #0f1730;
    --text: #e8eefc;
    --muted: #a9b5d6;
    --border: rgba(255,255,255,0.10);
    --shadow: 0 10px 30px rgba(0,0,0,0.35);
    --radius: 14px;
    --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
    --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";

    /* CISK */
    --c-challenge: #f0d24f;
    --c-challenge-bg: rgba(240,210,79,.14);
    --c-initiative: #8fd0ff;
    --c-initiative-bg: rgba(143,208,255,.14);
    --c-system: #1d4ed8;
    --c-system-bg: rgba(29,78,216,.12);
    --c-kpi: #22c55e;
    --c-kpi-bg: rgba(34,197,94,.12);
  }
  * { box-sizing: border-box; }
  body {
    margin: 0;
    font-family: var(--sans);
    background:
      radial-gradient(1200px 800px at 20% 0%, rgba(106,166,255,.14), transparent 55%),
      radial-gradient(900px 700px at 90% 10%, rgba(34,197,94,.10), transparent 60%),
      var(--bg);
    color: var(--text);
  }
  .wrap { max-width: 1250px; margin: 0 auto; padding: 0 16px; }
  header {
    position: sticky; top: 0; z-index: 20;
    background: linear-gradient(to bottom, rgba(11,18,32,.95), rgba(11,18,32,.70));
    backdrop-filter: blur(8px);
    border-bottom: 1px solid var(--border);
  }
  .topbar { display:flex; align-items:center; justify-content: space-between; gap: 12px; padding: 14px 0; }
  .title {
    font-weight: 800;
    letter-spacing: .2px;
    font-size: 15px;
    line-height: 1.2;
  }
  .tabs { display:flex; gap: 8px; flex-wrap: wrap; }
  .seasonbar{display:flex;align-items:center;gap:8px;flex-wrap:wrap;padding:0 0 12px 0;}
  .seasonlabel{font-size:12px;color:var(--muted);margin-right:4px;}
  .tabbtn {
    border: 1px solid var(--border);
    background: rgba(255,255,255,0.03);
    color: var(--muted);
    padding: 8px 10px;
    border-radius: 999px;
    font-size: 12px;
    cursor: pointer;
  }
  .tabbtn.active {
    color: var(--text);
    border-color: rgba(143,208,255,.45);
    background: rgba(143,208,255,.10);
  }
  main { padding: 16px 0 28px; }
  .grid2 { display:grid; grid-template-columns: 1fr 1fr; gap: 14px; }
  @media (max-width: 1100px) { .grid2 { grid-template-columns: 1fr; } }

  .panel {
    background: rgba(16,26,48,.88);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    box-shadow: var(--shadow);
    overflow: hidden;
  }
  .panel .hd {
    padding: 12px 12px 10px;
    border-bottom: 1px solid var(--border);
    background: rgba(0,0,0,0.10);
  }
  .h1 { font-size: 13px; font-weight: 800; letter-spacing: .2px; }
  .h2 { margin-top: 4px; font-size: 12px; color: var(--muted); line-height: 1.25; }
  .panel .bd { padding: 12px; }

  .search {
    display:flex; gap: 10px; align-items:center;
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 8px 10px;
    background: rgba(0,0,0,0.10);
  }
  .search input {
    width: 100%;
    background: transparent;
    border: 0;
    color: var(--text);
    font-size: 13px;
    outline: none;
  }

  .mono { font-family: var(--mono); }
  .muted { color: var(--muted); }

  .chip {
    display:inline-flex; align-items:center;
    border: 1px solid var(--border);
    border-radius: 999px;
    padding: 2px 8px;
    font-size: 11px;
    color: var(--muted);
    background: rgba(255,255,255,0.03);
  }
  .chip.group {
    background: var(--c-challenge-bg);
    border-color: rgba(240,210,79,.55);
    color: rgba(255, 242, 190, 0.98);
    font-weight: 800;
  }
  .chip.season {
    background: rgba(143,208,255,.10);
    border-color: rgba(143,208,255,.45);
    color: #dbe9ff;
    font-weight: 800;
  }

  .tree details { border-left: 4px solid var(--c-challenge); padding-left: 10px; }
  .tree details + details { margin-top: 8px; }
  .tree summary {
    list-style: none;
    cursor: pointer;
    user-select: none;
    padding: 6px 6px;
    border-radius: 10px;
    display:flex; align-items:center; justify-content: space-between;
  }
  .tree summary:hover { background: rgba(255,255,255,0.03); }
  .tree summary.active { background: rgba(240,210,79,.10); border: 1px solid rgba(240,210,79,.25); }
  .tree summary::-webkit-details-marker { display:none; }
  .sub { margin: 8px 0 10px 0; display:flex; flex-direction: column; gap: 6px; }
  .subitem {
    border: 1px solid var(--border);
    border-radius: 10px;
    padding: 8px 10px;
    font-size: 12.5px;
    cursor: pointer;
    background: rgba(0,0,0,0.08);
  }
  .subitem:hover { border-color: rgba(240,210,79,.35); }
  .subitem.active { border-color: rgba(240,210,79,.65); background: rgba(240,210,79,.10); }

  .list { display:flex; flex-direction: column; gap: 8px; margin-top: 12px; }
  .item {
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 10px;
    cursor: pointer;
    background: rgba(0,0,0,0.08);
  }
  .item:hover { border-color: rgba(143,208,255,.35); }
  .item.active { border-color: rgba(143,208,255,.65); background: rgba(143,208,255,.08); }
  .item .t { font-weight: 750; font-size: 12.5px; }
  .item .m { margin-top: 4px; font-size: 11.5px; color: var(--muted); line-height: 1.35; }
  .row { display:flex; align-items:center; gap: 8px; }

  .btn {
    border: 1px solid var(--border);
    background: rgba(255,255,255,0.03);
    color: var(--text);
    padding: 8px 10px;
    border-radius: 10px;
    font-size: 12px;
    cursor: pointer;
  }
  .btn.small { padding: 6px 8px; font-size: 11px; border-radius: 10px; }
  .btn.ghost { background: transparent; }
  .btn.primary {
    border-color: rgba(143,208,255,.45);
    background: rgba(143,208,255,.10);
  }

  .card {
    border: 1px solid var(--border);
    border-radius: 14px;
    padding: 12px;
    background: rgba(0,0,0,0.12);
  }
  .card h2 {
    margin: 0 0 6px 0;
    font-size: 15px;
    letter-spacing: .2px;
  }
  .card h3 {
    margin: 14px 0 8px 0;
    font-size: 12px;
    letter-spacing: .2px;
    color: rgba(255,255,255,0.92);
  }
  .hr { height: 1px; background: var(--border); margin: 12px 0; }

  .pillwrap { display:flex; flex-wrap: wrap; gap: 8px; }
  .pill {
    border: 1px solid var(--border);
    border-radius: 999px;
    padding: 6px 10px;
    font-size: 11.5px;
    cursor: pointer;
    background: rgba(255,255,255,0.03);
  }
  .pill:hover { filter: brightness(1.05); }
  .pill.chall { border-color: rgba(240,210,79,.55); background: rgba(240,210,79,.10); }
  .pill.init { border-color: rgba(143,208,255,.55); background: rgba(143,208,255,.10); }
  .pill.sys { border-color: rgba(29,78,216,.55); background: rgba(29,78,216,.12); }
  .pill.kpi { border-color: rgba(34,197,94,.55); background: rgba(34,197,94,.12); }

  .badge {
    display:inline-flex; align-items:center; justify-content:center;
    min-width: 34px;
    padding: 2px 8px;
    border-radius: 999px;
    font-size: 11px;
    font-weight: 900;
    border: 1px solid var(--border);
  }
  .badge.ch { background: rgba(240,210,79,.16); border-color: rgba(240,210,79,.55); color: rgba(255,242,190,.98); }
  .badge.in { background: rgba(143,208,255,.14); border-color: rgba(143,208,255,.55); color: #dbe9ff; }
  .badge.sy { background: rgba(29,78,216,.14); border-color: rgba(29,78,216,.55); color: rgba(210,225,255,.98); }
  .badge.kp { background: rgba(34,197,94,.14); border-color: rgba(34,197,94,.55); color: rgba(200,255,220,.98); }

  .footer { margin-top: 10px; font-size: 11.5px; color: var(--muted); }

  /* Workbench */
  .kanban { display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; }
  @media (max-width: 1100px) { .kanban { grid-template-columns: 1fr; } }
  .col {
    border: 1px dashed rgba(255,255,255,0.18);
    border-radius: 14px;
    padding: 10px;
    background: rgba(0,0,0,0.10);
    min-height: 220px;
  }
  .col h3 { margin: 0 0 8px 0; font-size: 12px; letter-spacing: .4px; color: var(--muted); text-transform: uppercase; }
  .wcard { border: 1px solid var(--border); border-radius: 12px; padding: 10px; background: rgba(0,0,0,0.14); margin-bottom: 8px; }
  .wcard .t { font-size: 12.5px; font-weight: 750; }
  .wcard .m { font-size: 11.5px; color: var(--muted); margin-top: 4px; line-height: 1.35; }
  .wcard .actions { margin-top: 8px; display:flex; gap: 6px; flex-wrap: wrap; }
</style>
</head>
<body>
<header>
  <div class="wrap">
    <div class="topbar">
      <div class="title">{{ title }} (v{{ version }}) - Standalone</div>
      <div class="tabs" id="tabs"></div>
    </div>
    <div class="seasonbar">
      <span class="seasonlabel">Season:</span>
      <button class="btn small ghost" data-season="ALL" onclick="setInitSeason('ALL')">All</button>
      <button class="btn small" data-season="S1" onclick="setInitSeason('S1')">S1</button>
      <button class="btn small" data-season="S2" onclick="setInitSeason('S2')">S2</button>
      <button class="btn small" data-season="S3" onclick="setInitSeason('S3')">S3</button>
      <span class="muted" style="margin:0 6px">|</span>
      <button class="btn small ghost" onclick="clearSelection()">Show all</button>
    </div>
  </div>
</header>

<main>
  <div class="wrap">
    <div id="tab-challenges" class="tab">
      <div class="grid2">
        <div class="panel">
          <div class="hd">
            <div class="h1">Challenges tree</div>
            <div class="h2">Click a challenge group (summary) or a sub‑challenge.</div>
          </div>
          <div class="bd">
            <div class="search"><span class="chip mono">/</span><input id="searchChallenges" placeholder="Search challenges…" /></div>
            <div class="tree" id="challengeTree" style="margin-top:12px"></div>
            <div class="footer">Tip: sub‑challenge view uses a best‑match mapping; parent challenge shows ALL items.</div>
          </div>
        </div>
        <div class="panel" id="challengeDetail">
          <div class="hd"><div class="h1">Details</div><div class="h2">Select something on the left.</div></div>
          <div class="bd" id="challengeDetailBody"></div>
        </div>
      </div>
    </div>

    <div id="tab-initiatives" class="tab" style="display:none">
      <div class="grid2">
        <div class="panel">
          <div class="hd"><div class="h1">Initiatives</div><div class="h2">Search.</div></div>
          <div class="bd">
            <div class="search"><span class="chip mono">/</span><input id="searchInitiatives" placeholder="Search initiatives…" /></div>
            <div class="list" id="initiativeList"></div>
          </div>
        </div>
        <div class="panel" id="initiativeDetail">
          <div class="hd"><div class="h1">Details</div><div class="h2">Select an initiative.</div></div>
          <div class="bd" id="initiativeDetailBody"></div>
        </div>
      </div>
    </div>

    <div id="tab-systems" class="tab" style="display:none">
      <div class="grid2">
        <div class="panel">
          <div class="hd"><div class="h1">Systems / enablers</div><div class="h2">Search, then click for linked initiatives + KPIs.</div></div>
          <div class="bd">
            <div class="search"><span class="chip mono">/</span><input id="searchSystems" placeholder="Search systems…" /></div>
            <div class="list" id="systemList"></div>
          </div>
        </div>
        <div class="panel" id="systemDetail">
          <div class="hd"><div class="h1">Details</div><div class="h2">Select a system.</div></div>
          <div class="bd" id="systemDetailBody"></div>
        </div>
      </div>
    </div>

    <div id="tab-kpis" class="tab" style="display:none">
      <div class="grid2">
        <div class="panel">
          <div class="hd"><div class="h1">KPIs</div><div class="h2">Search, then click for linked systems + initiatives.</div></div>
          <div class="bd">
            <div class="search"><span class="chip mono">/</span><input id="searchKpis" placeholder="Search KPIs…" /></div>
            <div class="list" id="kpiList"></div>
          </div>
        </div>
        <div class="panel" id="kpiDetail">
          <div class="hd"><div class="h1">Details</div><div class="h2">Select a KPI.</div></div>
          <div class="bd" id="kpiDetailBody"></div>
        </div>
      </div>
    </div>

    <div id="tab-workbench" class="tab" style="display:none">
      <div class="panel">
        <div class="hd"><div class="h1">Workbench (pin / re‑order)</div><div class="h2">Pin items to build your own live Q&A navigation.</div></div>
        <div class="bd">
          <div class="row">
            <button class="btn" onclick="clearWorkbench()">Clear</button>
            <button class="btn" onclick="saveWorkbench()">Save</button>
            <button class="btn" onclick="loadWorkbench()">Load</button>
            <span class="chip">Tip: on iPad, use ↑↓ if drag is awkward</span>
          </div>
          <div class="kanban" style="margin-top:12px" id="kanban"></div>
          <div class="footer">Pinned state is stored locally in your browser (safe to refresh).</div>
        </div>
      </div>
    </div>

  </div>
</main>

<script>
// Data embedded in standalone file
const DATA = {{ data_json | safe }};

// [REST OF THE JAVASCRIPT CODE - SAME AS navigator.html]
// Include all the JavaScript functions here...
</script>
<script src="data:text/javascript;base64,{{ js_code_base64 }}"></script>
</body>
</html>
