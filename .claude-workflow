# CISK Navigator - Development Workflow Instructions

## Quick Reference
- **Current App Version**: 2.4.0
- **Local Server Port**: 5002
- **Project Path**: /Users/mounir.dous/projects/CISK-Navigator
- **Main Data File**: data/full_sample_enhanced.yaml
- **GitHub Repo**: https://github.com/mounirdous/CISK-Navigator

## Version Management
- **App Version**: Located in `app.py` as `APP_VERSION` constant (currently 2.4.0)
- **YAML Data Version**: Specified in each YAML file's `meta.version` field (optional, defaults to "1.0")

## For Every Change:
1. **Increment the appropriate version** (x.y.z+1):
   - **Patch** (x.y.z+1): Bug fixes, small tweaks, minor improvements
   - **Minor** (x.y+1.0): New features, enhancements, significant changes
   - **Major** (x+1.0.0): Breaking changes, major refactors, API changes

2. **Update version in `app.py`**:
   ```python
   APP_VERSION = "x.y.z"
   ```

3. **Test on local server**:
   ```bash
   cd /Users/mounir.dous/projects/CISK-Navigator
   python app.py
   ```
   - Server runs on **http://localhost:5002** (port 5002)
   - Verify changes work correctly
   - Test with sample YAML files in the data/ directory

4. **Generate standalone HTML for testing**:
   ```bash
   python -c "from app import load_yaml_data, auto_detect_format, APP_VERSION; from jinja2 import Template; from datetime import datetime; yaml_data = load_yaml_data('data/full_sample_enhanced.yaml'); js_data = auto_detect_format(yaml_data); title = yaml_data.get('meta', {}).get('title', 'CISK Navigator'); data_version = yaml_data.get('meta', {}).get('version', '1.0'); template = Template(open('templates/navigator_enhanced.html').read()); html = template.render(data=js_data, title=title, data_version=data_version, app_version=APP_VERSION); open(f'cisk_navigator_{datetime.now().strftime(\"%Y%m%d_%H%M%S\")}.html', 'w').write(html); print('Generated!')"
   ```

5. **DO NOT commit to GitHub unless explicitly requested by user**

## Testing Checklist:
- [ ] App starts without errors on port 5002
- [ ] YAML files load correctly (both enhanced and legacy formats)
- [ ] Generated HTML displays properly
- [ ] Interactive features work (navigation, search, filters, priority sorting)
- [ ] Both app version and YAML data version display correctly
- [ ] Multi-link relationships work (challenges, initiatives, systems, KPIs)
- [ ] Weights and impacts display properly
- [ ] Upload page shows correct version and documentation

## Version History:
- **2.4.0** (2026-02-07): Analytics tracking support (Google Analytics, etc.)
- **2.3.3** (2026-02-07): Graph navigation fixes (A→B→A scenario)
- **2.3.1** (2026-02-07): Upload page documentation improvements, YAML version optional
- **2.3.0** (2026-02-07): Separate YAML title and dual version display (data + app)
- **2.2.9** (Previous): Graph view fixes

## Key Features:
- Enhanced format with multi-links
- Challenge/sub-challenge priorities (1=High, 2=Medium, 3=Low)
- Initiative → multiple challenges (with weight & impact)
- System → multiple initiatives (with weight)
- KPI → multiple systems (with weight)
- Auto-detection of enhanced vs legacy YAML format
- Dual version display: App version + YAML data version
- Customizable YAML title displayed in generated pages

## YAML Format Notes:
```yaml
meta:
  title: "Your Title"        # Required - displayed in generated HTML
  version: "1.0"             # Optional - defaults to "1.0" if not provided
  generated: "2026-02-07"    # Optional - metadata only
  tracking_code: |           # Optional - analytics tracking code (Google Analytics, etc.)
    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-XXXXXXXXXX"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-XXXXXXXXXX');
    </script>
```

See `TRACKING_EXAMPLES.md` for more analytics providers.

## Important Files:
- `app.py` - Main Flask application, contains APP_VERSION
- `templates/navigator_enhanced.html` - Main HTML template
- `templates/upload.html` - Upload interface
- `data/full_sample_enhanced.yaml` - Default data file
- `.claude-workflow` - This file (for Claude Code context)
- `.dev-notes` - Local-only development notes (not in Git)

## Notes:
- The app version is for the generator software itself
- The YAML version is for the data structure/schema version
- Both versions are displayed in the generated HTML
- Always test with both enhanced and legacy YAML formats
- Server runs on port 5002 (not 5001!)
